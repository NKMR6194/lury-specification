<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>4. 式 - Lury Specification 0.1</title>
  <script src="../../common/loader.js"></script>
  <script type="text/javascript">loader_load('../../')</script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-main markdown">

## 4. 式

この章では Lury の __式 (expression)__ について解説します。

<section id="primary">
### 4.1 原始式

_原始式_ (primary) は演算を含まない、式の基本的な要素です。

```
primary : identifier<span class="underline"></span>all
        | literal
```

<section id="identifier">
#### 4.1.1. 識別子

_識別子_ (identifier) はオブジェクトの名前を表現するために用います。構文解析における _identifier<span class="underline"></span>all_ はトークン Identifier とコンテキストキーワードを包括するものです。

トークン Identifier についての詳細は [2.5. 識別子](lexical.html#identifier) を参照してください。

</section>

<section id="literal">
#### 4.1.2. リテラル

```
literal : StringLiteral
        | EmbedStringLiteral
        | WysiwygStringLiteral
        | ImaginaryNumber
        | FloatNumber
        | Integer
```

_リテラル_ (literal) では文字列や数値の記述した値そのものを表すオブジェクトを生成します。これらは全て変更不能（イミュータブル）です。

トークン `StringLiteral`、`EmbedStringLiteral` そして `WysiwygStringLiteral` は String 型に、`ImaginaryNumber`、`FloatNumber` そして `Integer` はそれぞれ、Number 型から派生した Imaginary 型、Float 型、Integer 型となります。

数値はその値によって丸め誤差、オーバーフローやアンダーフローが起こりうることに注意してください。これは_表記上の値_と、_実際の値_と異なる場合があることを意味します。（__注__: 次期バージョンにて Number の派生クラスは最大値と最小値を取得できるよう機能が追加されます。）

</section>
</section>

<section id="primary">
#### 4.2. プライマリ

```
primary : atom
        | attribute<span class="underline"></span>reference
        | calling
```

_プライマリ_ (primary) には原始式と属性参照が含まれます。

プライマリで使われる演算子（ドット演算子）は Lury の中では最も優先順位が高く、ゆえにプライマリは最も結合度の高い要素となります。

<section id="attribute_reference">
#### 4.2.1. 属性参照

```
attribute<span class="underline"></span>reference : primary "." identifier<span class="underline"></span>all
```

_属性参照_ (attribute reference) はオブジェクトの属性 (attribute) を参照します。属性は _メンバ_ (member) とも呼ばれます。ドット演算子を介して、オブジェクトに含まれる属性にアクセスします。

属性参照がプライマリ中で単独で使用された場合、なおかつ指し示すオブジェクトが Function 型である場合はその関数が引数なしで実行されます。関数の呼び出しに関しては [4.2.2. 関数呼び出し](#calling) を参照してください。

</section>

<section id="calling">
#### 4.2.2. 関数呼び出し

```
calling        : primary '(' ')'
               | primary '(' arguments ')'

arguments      : argument
               | arguments ',' argument

argument       : expression
               | named<span class="underline"></span>argument

named<span class="underline"></span>argument : identifier<span class="underline"></span>all ':' expression
```

関数について、呼び出し側で実行に必要なデータを渡し、関数側で受け取ることができます。このようなデータを __引数__ と呼び、呼び出し側での引数を __実引数__ (argument)、関数側の引数を __仮引数__ (parameter) と区別して呼びます。

_calling_ は関数を呼び出し、実行するための構文です。関数呼び出しは関数名と丸括弧 `()` に挟まれた実引数リストによって構成されています。実引数を必要としない場合、実引数リストは空にすることができ、さらに丸括弧も省略可能です。

_名前付き引数_ (named argument) は、名前と仮引数値をコロン `:` で結合したものです。呼び出される関数に存在する仮引数名のみ使用することができます。同名の名前付き引数を複数回指定することはできません。

実引数リストの順番は、呼び出される仮引数の順番と一致している必要があります。名前付き引数の順番は任意に決めることができます。また、通常の実引数と名前付き引数は混在可能です。ただし、通常の実引数と名前付き引数で同一の仮引数を指定することはできません。

</section>

</section>

<section id="operation">
### 4.3. 演算式

Lury における _演算_ (operation) は、_演算子_ (operator) によって1つ以上のデータから別のデータを生成、もしくは元のデータを変換することを指します。演算の種類は生成、算術演算、ビット演算、論理演算、条件演算、代入そしてその他に分類できます。

Lury の演算子は 単項演算子、二項演算子、三項演算子 の3つです。一部の演算子は単項と二項とで同じ記号を用いますが、両者の演算は全く異なります。

演算と演算子はある特定の型に対してのみ、正常に動作します。要求する型以外が項として渡されたとき、実行時エラーが発生します。また、演算の出力の型は入力となる項の型によって変化します。

<section id="new">
#### 4.3.1. new 式

```
new<span class="underline"></span>expression : 'new' class<span class="underline"></span>name
               | 'new' class<span class="underline"></span>name new<span class="underline"></span>argument

new<span class="underline"></span>argument   : '(' ')'
               | '(' arguments ')'

class<span class="underline"></span>name     : identifier<span class="underline"></span>all
               | class<span class="underline"></span>name '.' identifier<span class="underline"></span>all
```

_new 式_ はクラスのコンストラクタを呼び出し、インスタンスを初期化してそれを返す式です。class<span class="underline"></span>name で用いることができるのはクラス名もしくは完全修飾されたクラス名（モジュール名を含む）です。

コンストラクタとなる関数には引数を与えることができます。コンストラクタの呼び出しは、単に関数呼び出しの一種と考えることができます。詳しくは [4.2.2. 関数呼び出し](#calling) を参照してください。
</section>

<section id="power">
#### 4.3.2. 冪乗演算

```
power<span class="underline"></span>expression : primary
                 | primary '**' unary<span class="underline"></span>expression
```

冪乗演算式は _冪乗演算_ (power operator) を行う二項演算です。結合性は _右_ (←) です。

単項演算子よりも優先順位が高いため、たとえば `-1 <span class="asterisk"></span><span class="asterisk"></span> 2` の結果は `-1` となります。括弧をつけてわかりやすくすると、`-(1 <span class="asterisk"></span><span class="asterisk"></span> 2)` となります。

二項が同じ型かつ冪数が正の数であるとき、冪乗の結果は二項と同じ型となります。基数が整数で冪数が負の数であるとき、結果は数値に依らず浮動小数点数となります。基数が負の数で冪数が浮動小数点数であるとき、結果は数値に依らず複素数になります。

Lury ではゼロのゼロ乗 (0<sup>0</sup>) は `1` として処理します。

基数がゼロで冪数が負の数であるときは実行時エラーが発生します。数値型以外のオブジェクトに対してこの演算は実行時エラーが発生します。
</section>

<section id="unary">
#### 4.3.3. 単項算術演算と単項ビット演算

```
unary<span class="underline"></span>expression : power
                 | '++' unary<span class="underline"></span>expression
                 | '--' unary<span class="underline"></span>expression
                 | '-' unary<span class="underline"></span>expression
                 | '+' unary<span class="underline"></span>expression
                 | '~' unary<span class="underline"></span>expression
                 | '!' unary<span class="underline"></span>expression
                 | new<span class="underline"></span>expression
```

単項演算はただ一つの項を持つ演算です。結合性は _右_ (←) です。

単項演算子よりも優先順位が高いため、たとえば `-1 <span class="asterisk"></span><span class="asterisk"></span> 2` の結果は `-1` となります。括弧をつけてわかりやすくすると、`-(1 <span class="asterisk"></span><span class="asterisk"></span> 2)` となります。

二項が同じ型かつ冪数が正の数であるとき、冪乗の結果は二項と同じ型となります。基数が整数で冪数が負の数であるとき、結果は数値に依らず浮動小数点数となります。基数が負の数で冪数が浮動小数点数であるとき、結果は数値に依らず複素数になります。

Lury ではゼロのゼロ乗 (0<sup>0</sup>) は `1` として処理します。

基数がゼロで冪数が負の数であるときは実行時エラーが発生します。数値型以外のオブジェクトに対してこの演算は実行時エラーが発生します。
</section>

</section>

__ (work in progress) __

<section id="cite">
### 参考文献

- [6. 式 (expression) — Python 3.4.3 ドキュメント](http://docs.python.jp/3.4/reference/expressions.html)
- [式 - プログラミング言語 D (日本語訳)](http://www.kmonos.net/alang/d/expression.html)

</section>

      </div>
    </div>
  </div>
</body>
</html>
